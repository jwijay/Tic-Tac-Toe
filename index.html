<!doctype html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>hello phaser!</title>
        <script src="phaser.min.js"></script>
    </head>
    <body>

    <script type="text/javascript">

    window.onload = function() {



        var game = new Phaser.Game(600, 600, Phaser.AUTO, '', { preload: preload, create: create });

        function preload () {
            //load spritesheet!!
            game.load.spritesheet('tiles', 'img/tiles.png', 200, 200);

        }

        //initialize vars here
        var tileSide = 200;

        //tile spritesheet order (0-5): pb, marcy, lsp, jake, finn, bmo
        var blank = 6;      //gunter
        var player1 = 3;    //jake
        var player2 = 5;    //bmo

        //TODO: check if I want this as global var
        var tilePositions = [];
        var tiles = [];

        var style = { font: "40px Arial", fill: "#ff0044", align: "center" };
        var message = '';
        var winner = '';
        var turn = 1;   //1 (player1) || 2 (player 2)

        function create () {

            //From top to bottom, then left to right.
            tilePositions = [[0,0], [0,1], [0,2], [1,0], [1,1], [1,2], [2,0], [2,1], [2,2]];

            for (var i = 0; i < 9; i++) {
                tilePosX = tilePositions[i][0]*tileSide;
                tilePosY = tilePositions[i][1]*tileSide;
                tilePositions[i][2] = '';   //store who is occupying tile (player1, player2, etc)

                tiles[i] = game.add.sprite(tilePosX,tilePosY,'tiles',blank);
                tiles[i].width = tileSide;
                tiles[i].height = tileSide;

                // This shitz be important. TODO: check if this is ok in create, or if we need to pause actionOnClick during computer/player2 turn
                tiles[i].inputEnabled = true;
                tiles[i].events.onInputDown.add(actionOnClick,this);

                //GAME STATUS/MESSAGE!
                // game.add.text(game.world.centerX, 0, message, style);

            }

        }

        function actionOnClick (currTile) {
            currentTilePos = tiles.indexOf(currTile);
            if (turn === 1) {
              if (currTile.frame === blank) {
                currTile.frame = player1;
                //set tilePosition as occupied by player '1'
                tilePositions[currentTilePos][2] = '1';
                
                turn = 2;
                
              }
              setTimeout(computerPlay,1000);   
            } else {   
                
            /*
              if (currTile.frame === blank) {
                currTile.frame = player2;
                //set tilePosition as occupied by player '2'
                tilePositions[currentTilePos][2] = '2';

                turn = 1;*/
            }


            //Sample debugging message (see if game will display message on player's click)
            message = "Player " + turn + " Moved.";

            console.log(message);
        }

        function computerPlay () {
          var randomTile = tiles[Math.floor(Math.random()*9)];

          while (randomTile.frame !== blank) {
            randomTile = tiles[Math.floor(Math.random()*9)];
          }
          randomTile.frame = player2;
          turn = 1;
        }

    };

    </script>

    </body>
</html>